<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema ABS - Fluxo Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2b2b2b 100%);
            min-height: 100vh;
        }
        .card-hover { 
            transition: all 0.3s ease; 
            position: relative;
            overflow: hidden;
        }
        .card-hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        .card-hover:hover::before {
            left: 100%;
        }
        .card-hover:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
        }
        .badge-pulse { 
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 
            0%, 100% { opacity: 1; transform: scale(1); } 
            50% { opacity: 0.8; transform: scale(1.05); } 
        }
        .gradient-pe { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-go { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .gradient-sp { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .warehouse-icon {
            font-size: 4rem;
            opacity: 0.2;
            position: absolute;
            right: 20px;
            bottom: 20px;
        }
        .tela { display: none; }
        .tela.active { display: block; }
        .badge-auto {
            position: relative;
            cursor: help;
        }
        .tooltip-auto {
            display: none;
            position: absolute;
            bottom: 100%;
            right: 0;
            background: #1f2937;
            border: 1px solid #4b5563;
            padding: 12px;
            border-radius: 8px;
            width: 280px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        .badge-auto:hover .tooltip-auto {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

<!-- ========================================== -->
<!-- TELA 1: PORTAL PRINCIPAL -->
<!-- ========================================== -->
<div id="tela-portal" class="tela active container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header Portal -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-xl">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-white mb-2">
                        <i class="fas fa-home mr-3 text-blue-400"></i>
                        Portal SPX Fulfillment
                    </h1>
                    <p class="text-gray-400">Bem-vindo, Rafael Mateus | N√≠vel: Administrador</p>
                </div>
                <button class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-all">
                    <i class="fas fa-sign-out-alt mr-2"></i>Sair
                </button>
            </div>
        </div>

        <!-- Cards de Op√ß√µes -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Card ABS - DESTAQUE -->
            <div onclick="irPara('tela-warehouses')" class="card-hover bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl p-6 cursor-pointer border-2 border-blue-400 shadow-xl">
                <div class="flex items-start justify-between mb-4">
                    <div class="bg-white/20 p-3 rounded-lg backdrop-blur-sm">
                        <i class="fas fa-user-check text-3xl text-white"></i>
                    </div>
                    <span class="bg-green-500 text-white text-xs px-3 py-1 rounded-full badge-pulse shadow-lg">
                        ‚óè ONLINE
                    </span>
                </div>
                <h3 class="text-xl font-bold mb-2">Sistema ABS</h3>
                <p class="text-blue-100 text-sm mb-4">Controle de Absente√≠smo e Presen√ßa</p>
                <div class="flex items-center justify-between">
                    <span class="text-xs text-blue-200">
                        <i class="fas fa-warehouse mr-1"></i>
                        Multi-Warehouse
                    </span>
                    <i class="fas fa-arrow-right text-white"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- TELA 2: SELE√á√ÉO DE WAREHOUSE -->
<!-- ========================================== -->
<div id="tela-warehouses" class="tela container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-gray-800 rounded-xl p-6 mb-6 shadow-xl">
            <div class="flex items-center justify-between">
                <div>
                    <button onclick="irPara('tela-portal')" class="text-blue-400 hover:text-blue-300 mb-3 transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar ao Portal
                    </button>
                    <h1 class="text-4xl font-bold mb-2">
                        <i class="fas fa-warehouse mr-3 text-blue-400"></i>
                        Sistema ABS
                    </h1>
                    <p class="text-gray-400 text-lg">Selecione o Warehouse (Centro de Distribui√ß√£o)</p>
                </div>
            </div>
        </div>

        <!-- Estat√≠sticas Gerais -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-gray-800 rounded-xl p-4 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Colaboradores Ativos</p>
                        <p class="text-3xl font-bold text-white">482</p>
                        <p class="text-xs text-green-400 mt-1">
                            <i class="fas fa-check-circle mr-1"></i>
                            Data Desligamento vazia
                        </p>
                    </div>
                    <div class="bg-blue-600 w-12 h-12 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users text-white text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-xl p-4 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Supervisores Ativos</p>
                        <p class="text-3xl font-bold text-white">24</p>
                    </div>
                    <div class="bg-purple-600 w-12 h-12 rounded-lg flex items-center justify-center">
                        <i class="fas fa-user-tie text-white text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-xl p-4 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Pend√™ncias Total</p>
                        <p class="text-3xl font-bold text-yellow-400">12</p>
                    </div>
                    <div class="bg-yellow-600 w-12 h-12 rounded-lg flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-white text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cards de Warehouses -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- WAREHOUSE: PERNAMBUCO -->
            <div onclick="selecionarWarehouse('PE')" class="card-hover gradient-pe rounded-xl p-6 cursor-pointer shadow-2xl border-2 border-purple-400 relative">
                <i class="fas fa-warehouse warehouse-icon text-white"></i>
                
                <div class="relative z-10">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-white/20 p-3 rounded-lg backdrop-blur-sm">
                            <i class="fas fa-building text-3xl text-white"></i>
                        </div>
                        <span class="bg-green-500 text-white text-xs px-3 py-1 rounded-full shadow-lg">
                            ‚óè ATIVO
                        </span>
                    </div>

                    <h3 class="text-2xl font-bold mb-2 text-white">Pernambuco</h3>
                    <p class="text-purple-100 text-lg font-bold mb-1">FBS PE - Jaboat√£o</p>

                    <div class="space-y-2 mb-4">
                        <div class="flex items-center justify-between text-sm bg-white/10 rounded-lg p-2 backdrop-blur-sm">
                            <span class="text-purple-100">
                                <i class="fas fa-users mr-2"></i>Colaboradores Ativos
                            </span>
                            <span class="font-bold text-white">156</span>
                        </div>
                        <div class="flex items-center justify-between text-sm bg-white/10 rounded-lg p-2 backdrop-blur-sm">
                            <span class="text-purple-100">
                                <i class="fas fa-user-tie mr-2"></i>Supervisores
                            </span>
                            <span class="font-bold text-white">8</span>
                        </div>
                    </div>

                    <button class="w-full bg-white text-purple-700 font-bold px-4 py-3 rounded-lg hover:bg-purple-50 transition-all shadow-lg">
                        <i class="fas fa-arrow-right mr-2"></i>Acessar Warehouse
                    </button>
                </div>
            </div>

            <!-- WAREHOUSE: GOI√ÅS -->
            <div onclick="selecionarWarehouse('GO')" class="card-hover gradient-go rounded-xl p-6 cursor-pointer shadow-2xl border-2 border-pink-400 relative">
                <i class="fas fa-warehouse warehouse-icon text-white"></i>
                
                <div class="relative z-10">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-white/20 p-3 rounded-lg backdrop-blur-sm">
                            <i class="fas fa-building text-3xl text-white"></i>
                        </div>
                        <span class="bg-green-500 text-white text-xs px-3 py-1 rounded-full shadow-lg">
                            ‚óè ATIVO
                        </span>
                    </div>

                    <h3 class="text-2xl font-bold mb-2 text-white">Goi√°s</h3>
                    <p class="text-pink-100 text-lg font-bold mb-1">FBS GO - Aparecida</p>

                    <div class="space-y-2 mb-4">
                        <div class="flex items-center justify-between text-sm bg-white/10 rounded-lg p-2 backdrop-blur-sm">
                            <span class="text-pink-100">
                                <i class="fas fa-users mr-2"></i>Colaboradores Ativos
                            </span>
                            <span class="font-bold text-white">189</span>
                        </div>
                        <div class="flex items-center justify-between text-sm bg-white/10 rounded-lg p-2 backdrop-blur-sm">
                            <span class="text-pink-100">
                                <i class="fas fa-user-tie mr-2"></i>Supervisores
                            </span>
                            <span class="font-bold text-white">9</span>
                        </div>
                    </div>

                    <button class="w-full bg-white text-pink-700 font-bold px-4 py-3 rounded-lg hover:bg-pink-50 transition-all shadow-lg">
                        <i class="fas fa-arrow-right mr-2"></i>Acessar Warehouse
                    </button>
                </div>
            </div>

            <!-- WAREHOUSE: S√ÉO PAULO -->
            <div onclick="selecionarWarehouse('SP')" class="card-hover gradient-sp rounded-xl p-6 cursor-pointer shadow-2xl border-2 border-cyan-400 relative">
                <i class="fas fa-warehouse warehouse-icon text-white"></i>
                
                <div class="relative z-10">
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-white/20 p-3 rounded-lg backdrop-blur-sm">
                            <i class="fas fa-building text-3xl text-white"></i>
                        </div>
                        <span class="bg-green-500 text-white text-xs px-3 py-1 rounded-full shadow-lg">
                            ‚óè ATIVO
                        </span>
                    </div>

                    <h3 class="text-2xl font-bold mb-2 text-white">S√£o Paulo</h3>
                    <p class="text-cyan-100 text-lg font-bold mb-1">FBS SP - Franco da Rocha</p>

                    <div class="space-y-2 mb-4">
                        <div class="flex items-center justify-between text-sm bg-white/10 rounded-lg p-2 backdrop-blur-sm">
                            <span class="text-cyan-100">
                                <i class="fas fa-users mr-2"></i>Colaboradores Ativos
                            </span>
                            <span class="font-bold text-white">137</span>
                        </div>
                        <div class="flex items-center justify-between text-sm bg-white/10 rounded-lg p-2 backdrop-blur-sm">
                            <span class="text-cyan-100">
                                <i class="fas fa-user-tie mr-2"></i>Supervisores
                            </span>
                            <span class="font-bold text-white">7</span>
                        </div>
                    </div>

                    <button class="w-full bg-white text-cyan-700 font-bold px-4 py-3 rounded-lg hover:bg-cyan-50 transition-all shadow-lg">
                        <i class="fas fa-arrow-right mr-2"></i>Acessar Warehouse
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- TELA 3: SELE√á√ÉO DE M√äS -->
<!-- ========================================== -->
<div id="tela-meses" class="tela container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-gray-800 rounded-xl p-6 mb-6 shadow-xl">
            <div class="flex items-center justify-between">
                <div>
                    <button onclick="irPara('tela-warehouses')" class="text-blue-400 hover:text-blue-300 mb-3 transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar aos Warehouses
                    </button>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-user-check mr-3 text-blue-400"></i>
                        Sistema ABS - <span id="warehouse-nome">S√£o Paulo</span>
                    </h1>
                    <p class="text-gray-400">Selecione o M√™s - 2026</p>
                    <p class="text-yellow-400 text-sm mt-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Apenas o m√™s atual pode ser editado.
                    </p>
                </div>
            </div>
        </div>

        <!-- Grid de Meses -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Janeiro - BLOQUEADO -->
            <div class="bg-gradient-to-br from-gray-700 to-gray-900 rounded-xl p-6 border-2 border-gray-600 shadow-2xl opacity-60 cursor-not-allowed">
                <h3 class="text-xl font-bold mb-2 text-gray-400">Janeiro</h3>
                <p class="text-gray-400 text-sm mb-4">
                    <i class="fas fa-lock mr-2"></i>Bloqueado
                </p>
                <button disabled class="w-full bg-gray-600 text-gray-400 font-bold px-4 py-2 rounded-lg cursor-not-allowed">
                    Bloqueado
                </button>
            </div>

            <!-- Fevereiro (m√™s atual - destaque) -->
            <div onclick="irPara('tela-supervisores')" class="card-hover bg-gradient-to-br from-green-600 to-green-800 rounded-xl p-6 cursor-pointer border-2 border-green-400 shadow-2xl">
                <h3 class="text-xl font-bold mb-2">Fevereiro</h3>
                <p class="text-green-200 text-sm mb-4">
                    <i class="fas fa-calendar-check mr-2"></i>üìÖ M√äS ATUAL
                </p>
                <button class="w-full bg-white text-green-700 font-bold px-4 py-2 rounded-lg hover:bg-green-50 transition-all">
                    Abrir
                </button>
            </div>

            <!-- Mar√ßo - BLOQUEADO -->
            <div class="bg-gradient-to-br from-gray-700 to-gray-900 rounded-xl p-6 border-2 border-gray-600 shadow-2xl opacity-60 cursor-not-allowed">
                <h3 class="text-xl font-bold mb-2 text-gray-400">Mar√ßo</h3>
                <p class="text-gray-400 text-sm mb-4">
                    <i class="fas fa-lock mr-2"></i>Bloqueado
                </p>
                <button disabled class="w-full bg-gray-600 text-gray-400 font-bold px-4 py-2 rounded-lg cursor-not-allowed">
                    Bloqueado
                </button>
            </div>

            <!-- Abril - BLOQUEADO -->
            <div class="bg-gradient-to-br from-gray-700 to-gray-900 rounded-xl p-6 border-2 border-gray-600 shadow-2xl opacity-60 cursor-not-allowed">
                <h3 class="text-xl font-bold mb-2 text-gray-400">Abril</h3>
                <p class="text-gray-400 text-sm mb-4">
                    <i class="fas fa-lock mr-2"></i>Bloqueado
                </p>
                <button disabled class="w-full bg-gray-600 text-gray-400 font-bold px-4 py-2 rounded-lg cursor-not-allowed">
                    Bloqueado
                </button>
            </div>

            <!-- Maio - BLOQUEADO -->
            <div class="bg-gradient-to-br from-gray-700 to-gray-900 rounded-xl p-6 border-2 border-gray-600 shadow-2xl opacity-60 cursor-not-allowed">
                <h3 class="text-xl font-bold mb-2 text-gray-400">Maio</h3>
                <p class="text-gray-400 text-sm mb-4">
                    <i class="fas fa-lock mr-2"></i>Bloqueado
                </p>
                <button disabled class="w-full bg-gray-600 text-gray-400 font-bold px-4 py-2 rounded-lg cursor-not-allowed">
                    Bloqueado
                </button>
            </div>

            <!-- Junho - BLOQUEADO -->
            <div class="bg-gradient-to-br from-gray-700 to-gray-900 rounded-xl p-6 border-2 border-gray-600 shadow-2xl opacity-60 cursor-not-allowed">
                <h3 class="text-xl font-bold mb-2 text-gray-400">Junho</h3>
                <p class="text-gray-400 text-sm mb-4">
                    <i class="fas fa-lock mr-2"></i>Bloqueado
                </p>
                <button disabled class="w-full bg-gray-600 text-gray-400 font-bold px-4 py-2 rounded-lg cursor-not-allowed">
                    Bloqueado
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- TELA 4: SELE√á√ÉO DE SUPERVISOR -->
<!-- ========================================== -->
<div id="tela-supervisores" class="tela container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-gray-800 rounded-xl p-6 mb-6 shadow-xl">
            <div class="flex items-center justify-between">
                <div>
                    <button onclick="irPara('tela-meses')" class="text-blue-400 hover:text-blue-300 mb-3 transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar aos Meses
                    </button>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-user-tie mr-3 text-blue-400"></i>
                        Sele√ß√£o de Supervisor - Fevereiro 2026
                    </h1>
                    <p class="text-gray-400">S√£o Paulo (SP) - Franco da Rocha</p>
                </div>
            </div>
        </div>

        <!-- Busca -->
        <div class="bg-gray-800 rounded-xl p-4 mb-6 shadow-xl">
            <label class="text-gray-400 text-sm mb-2 block">
                <i class="fas fa-search mr-2"></i>Buscar Supervisor
            </label>
            <input type="text" 
                   placeholder="Nome do supervisor..." 
                   class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none">
        </div>

        <!-- Lista de Supervisores -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div onclick="selecionarSupervisor('Jo√£o Carlos Silva')" class="card-hover bg-gray-800 rounded-xl p-6 cursor-pointer border border-gray-700 shadow-xl hover:border-blue-500">
                <div class="flex items-center">
                    <div class="bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center font-bold text-2xl mr-4">
                        JC
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold">Jo√£o Carlos Silva</h3>
                        <p class="text-gray-400 text-sm">24 colaboradores</p>
                        <div class="flex gap-2 mt-2">
                            <span class="text-xs bg-green-600 px-2 py-1 rounded">18 marcados</span>
                            <span class="text-xs bg-yellow-600 px-2 py-1 rounded">6 pendentes</span>
                        </div>
                    </div>
                    <i class="fas fa-arrow-right text-gray-500 text-xl"></i>
                </div>
            </div>

            <div onclick="selecionarSupervisor('Maria Santos Lima')" class="card-hover bg-gray-800 rounded-xl p-6 cursor-pointer border border-gray-700 shadow-xl hover:border-purple-500">
                <div class="flex items-center">
                    <div class="bg-purple-600 w-16 h-16 rounded-full flex items-center justify-center font-bold text-2xl mr-4">
                        MS
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold">Maria Santos Lima</h3>
                        <p class="text-gray-400 text-sm">19 colaboradores</p>
                        <div class="flex gap-2 mt-2">
                            <span class="text-xs bg-green-600 px-2 py-1 rounded">19 marcados</span>
                        </div>
                    </div>
                    <i class="fas fa-arrow-right text-gray-500 text-xl"></i>
                </div>
            </div>

            <div onclick="selecionarSupervisor('Pedro Costa Silva')" class="card-hover bg-gray-800 rounded-xl p-6 cursor-pointer border border-gray-700 shadow-xl hover:border-orange-500">
                <div class="flex items-center">
                    <div class="bg-orange-600 w-16 h-16 rounded-full flex items-center justify-center font-bold text-2xl mr-4">
                        PC
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold">Pedro Costa Silva</h3>
                        <p class="text-gray-400 text-sm">22 colaboradores</p>
                        <div class="flex gap-2 mt-2">
                            <span class="text-xs bg-green-600 px-2 py-1 rounded">15 marcados</span>
                            <span class="text-xs bg-yellow-600 px-2 py-1 rounded">7 pendentes</span>
                        </div>
                    </div>
                    <i class="fas fa-arrow-right text-gray-500 text-xl"></i>
                </div>
            </div>

            <div onclick="selecionarSupervisor('Ana Paula Rocha')" class="card-hover bg-gray-800 rounded-xl p-6 cursor-pointer border border-gray-700 shadow-xl hover:border-pink-500">
                <div class="flex items-center">
                    <div class="bg-pink-600 w-16 h-16 rounded-full flex items-center justify-center font-bold text-2xl mr-4">
                        AP
                    </div>
                    <div class="flex-1">
                        <h3 class="text-xl font-bold">Ana Paula Rocha</h3>
                        <p class="text-gray-400 text-sm">18 colaboradores</p>
                        <div class="flex gap-2 mt-2">
                            <span class="text-xs bg-green-600 px-2 py-1 rounded">18 marcados</span>
                        </div>
                    </div>
                    <i class="fas fa-arrow-right text-gray-500 text-xl"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- TELA 5: CALEND√ÅRIO DO M√äS -->
<!-- ========================================== -->
<div id="tela-calendario" class="tela container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-gray-800 rounded-xl p-6 mb-6 shadow-xl">
            <div class="flex items-center justify-between">
                <div>
                    <button onclick="irPara('tela-supervisores')" class="text-blue-400 hover:text-blue-300 mb-3 transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar aos Supervisores
                    </button>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-calendar-alt mr-3 text-blue-400"></i>
                        Calend√°rio - Fevereiro 2026
                    </h1>
                    <p class="text-gray-400">
                        Supervisor: Jo√£o Carlos Silva | 24 colaboradores
                    </p>
                </div>
            </div>
        </div>

        <!-- Calend√°rio -->
        <div class="bg-gray-800 rounded-xl p-6 shadow-xl">
            <div class="grid grid-cols-7 gap-2">
                <!-- Header dos dias da semana -->
                <div class="text-center font-bold text-gray-400 p-2">Dom</div>
                <div class="text-center font-bold text-gray-400 p-2">Seg</div>
                <div class="text-center font-bold text-gray-400 p-2">Ter</div>
                <div class="text-center font-bold text-gray-400 p-2">Qua</div>
                <div class="text-center font-bold text-gray-400 p-2">Qui</div>
                <div class="text-center font-bold text-gray-400 p-2">Sex</div>
                <div class="text-center font-bold text-gray-400 p-2">S√°b</div>

                <!-- Dias do m√™s - TODOS CLIC√ÅVEIS -->
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">1</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">2</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">3</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">4</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">5</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-yellow-700 rounded-lg p-3 text-center cursor-pointer border border-yellow-500">
                    <div class="text-lg font-bold">6</div>
                    <div class="text-xs text-yellow-200">‚ö†Ô∏è Pendente</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">7</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>

                <!-- Segunda semana -->
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">8</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">9</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">10</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-yellow-700 rounded-lg p-3 text-center cursor-pointer border border-yellow-500">
                    <div class="text-lg font-bold">11</div>
                    <div class="text-xs text-yellow-200">‚ö†Ô∏è Pendente</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">12</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">13</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">14</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>

                <!-- Terceira semana -->
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-green-700 rounded-lg p-3 text-center cursor-pointer border border-green-500">
                    <div class="text-lg font-bold">15</div>
                    <div class="text-xs text-green-200">‚úÖ Completo</div>
                </div>
                <!-- Dia atual (16) - Destacado -->
                <div onclick="irPara('tela-marcacao')" class="bg-gradient-to-br from-green-600 to-green-800 rounded-lg p-3 text-center cursor-pointer border-2 border-green-400 card-hover">
                    <div class="text-2xl font-bold">16</div>
                    <div class="text-xs text-green-200">‚úÖ HOJE</div>
                    <div class="text-xs text-yellow-300 mt-1">6 pendentes</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">17</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">18</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">19</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">20</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">21</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>

                <!-- Quarta semana -->
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">22</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">23</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">24</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">25</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">26</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">27</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
                <div onclick="irPara('tela-marcacao')" class="card-hover bg-gray-700 rounded-lg p-3 text-center cursor-pointer border border-gray-600">
                    <div class="text-lg font-bold">28</div>
                    <div class="text-xs text-gray-400">Futuro</div>
                </div>
            </div>
        </div>

        <!-- Legenda -->
        <div class="mt-6 bg-gray-800 rounded-xl p-4 shadow-xl">
            <h3 class="font-bold mb-3">Legenda:</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-green-600 rounded"></div>
                    <span>Completo</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-yellow-600 rounded"></div>
                    <span>Pendente</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-gray-700 rounded"></div>
                    <span>N√£o iniciado</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-blue-600 rounded border-2 border-blue-400"></div>
                    <span>Hoje</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========================================== -->
<!-- TELA 6: MARCA√á√ÉO DE PRESEN√áA -->
<!-- ========================================== -->
<div id="tela-marcacao" class="tela container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-gray-800 rounded-xl p-6 mb-6 shadow-xl">
            <div class="flex items-center justify-between">
                <div>
                    <button onclick="irPara('tela-calendario')" class="text-blue-400 hover:text-blue-300 mb-3 transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar ao Calend√°rio
                    </button>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-check-square mr-3 text-blue-400"></i>
                        Marca√ß√£o de Presen√ßa - Dia 16/02/2026
                    </h1>
                    <p class="text-gray-400">
                        <i class="fas fa-warehouse mr-2"></i>S√£o Paulo (SP) - Franco da Rocha
                        <span class="mx-2">|</span>
                        <i class="fas fa-user-tie mr-2"></i>Supervisor: Jo√£o Carlos Silva
                    </p>
                </div>
                <div class="text-right">
                    <div class="bg-green-600/20 border border-green-600 rounded-lg px-4 py-2">
                        <p class="text-green-400 font-bold text-xl">18/24</p>
                        <p class="text-green-300 text-sm">Marcados</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerta de Presen√ßa Autom√°tica -->
        <div class="bg-blue-900/30 border border-blue-500/50 rounded-xl p-4 mb-6 flex items-start">
            <div class="bg-blue-600 w-10 h-10 rounded-lg flex items-center justify-center mr-4 flex-shrink-0">
                <i class="fas fa-robot text-white"></i>
            </div>
            <div class="flex-1">
                <h3 class="font-bold text-blue-400 mb-1">ü§ñ Marca√ß√£o Autom√°tica Ativa</h3>
                <p class="text-gray-300 text-sm">
                    18 colaboradores tiveram presen√ßa marcada automaticamente via sistema de ponto eletr√¥nico (raw_scan).
                </p>
            </div>
        </div>

        <!-- Busca -->
        <div class="bg-gray-800 rounded-xl p-4 mb-6 shadow-xl">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="md:col-span-2">
                    <label class="text-gray-400 text-sm mb-2 block">
                        <i class="fas fa-search mr-2"></i>Buscar Colaborador
                    </label>
                    <input type="text" 
                           id="busca-colaborador"
                           placeholder="Nome ou WFM User..." 
                           class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-2 block">
                        <i class="fas fa-filter mr-2"></i>Filtrar por Status
                    </label>
                    <select class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none">
                        <option>Todos</option>
                        <option>Marcados</option>
                        <option>Pendentes</option>
                        <option>Autom√°ticos</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Lista de Colaboradores -->
        <div class="bg-gray-800 rounded-xl p-6 shadow-xl mb-6">
            <h2 class="text-xl font-bold mb-4" id="info-dia">
                <i class="fas fa-users mr-2 text-blue-400"></i>
                Colaboradores (24 total)
            </h2>

            <div id="colaboradores-list" class="space-y-3">
                
                <!-- Colaborador 1: PRESEN√áA AUTOM√ÅTICA -->
                <div class="bg-gray-700 rounded-lg p-4 flex items-center justify-between hover:bg-gray-650 border-l-4 border-green-500">
                    <div class="flex items-center flex-1">
                        <div class="bg-green-600 w-12 h-12 rounded-full flex items-center justify-center font-bold mr-4">
                            <i class="fas fa-check text-white"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <h3 class="font-bold">Jo√£o Silva Santos</h3>
                                <span class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full badge-auto">
                                    ü§ñ AUTO
                                    <div class="tooltip-auto">
                                        <div class="font-bold text-blue-400 mb-2">
                                            <i class="fas fa-robot mr-1"></i>
                                            Presen√ßa Autom√°tica
                                        </div>
                                        <div class="text-xs space-y-1">
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">WFM User:</span>
                                                <span class="text-white">joao.silva</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Primeira batida:</span>
                                                <span class="text-green-400">07:45</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Hor√°rio esperado:</span>
                                                <span class="text-white">08:00</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Toler√¢ncia:</span>
                                                <span class="text-green-400">‚úÖ Dentro (¬±1h)</span>
                                            </div>
                                        </div>
                                    </div>
                                </span>
                            </div>
                            <p class="text-gray-400 text-sm">
                                WFM: joao.silva | Operador Inbound | Admiss√£o: 15/01/2024
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <select class="bg-gray-600 text-white px-4 py-2 rounded-lg border border-green-500 focus:outline-none">
                            <option value="P" selected>P - Presente</option>
                            <option value="F">F - Falta Injustificada</option>
                            <option value="FJ">FJ - Falta Justificada</option>
                            <option value="FE">FE - F√©rias</option>
                            <option value="FO">FO - Folga</option>
                            <option value="DSR">DSR - Descanso Semanal Remunerado</option>
                            <option value="AM">AM - Atestado M√©dico</option>
                            <option value="AF">AF - Afastamento (1¬∫ √† 15¬∫ dia)</option>
                            <option value="AL">AL - Afastamento INSS (16¬∫ dia+)</option>
                            <option value="BH">BH - Banco de Horas</option>
                            <option value="TR">TR - Transfer√™ncia Fixa</option>
                            <option value="SU">SU - Suspens√£o</option>
                            <option value="PR">PR - Promo√ß√£o</option>
                            <option value="S1">S1 - Sinergia Enviada</option>
                            <option value="S2">S2 - Sinergia Recebida</option>
                            <option value="DF">DF - Desligamento For√ßado</option>
                            <option value="DV">DV - Desligamento Volunt√°rio</option>
                            <option value="DP">DP - Desligamento Planejado</option>
                            <option value="NC">NC - N√£o Contratado</option>
                        </select>
                        <button onclick="abrirModalHoraExtra('Jo√£o Silva Santos', 'joao.silva')" 
                                class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg transition-all flex items-center gap-1"
                                title="Registrar Hora Extra">
                            <i class="fas fa-clock"></i>
                            <span class="text-xs">HE</span>
                        </button>
                        <button onclick="abrirModalSinergia('Jo√£o Silva Santos', 'joao.silva', 'Inbound')" 
                                class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg transition-all flex items-center gap-1"
                                title="Registrar Sinergia">
                            <i class="fas fa-exchange-alt"></i>
                            <span class="text-xs">SIN</span>
                        </button>
                        <span class="text-green-400">
                            <i class="fas fa-check-circle text-xl"></i>
                        </span>
                    </div>
                </div>

                <!-- Colaborador 2: PENDENTE -->
                <div class="bg-gray-700 rounded-lg p-4 flex items-center justify-between hover:bg-gray-650 border-l-4 border-yellow-500">
                    <div class="flex items-center flex-1">
                        <div class="bg-yellow-600 w-12 h-12 rounded-full flex items-center justify-center font-bold mr-4">
                            <i class="fas fa-question text-white"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <h3 class="font-bold">Ana Paula Oliveira</h3>
                                <span class="bg-yellow-600 text-white text-xs px-2 py-1 rounded-full">
                                    ‚ö†Ô∏è SEM SCAN
                                </span>
                            </div>
                            <p class="text-gray-400 text-sm">
                                WFM: ana.oliveira | Operador Flow | Admiss√£o: 05/09/2023
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <select class="bg-gray-600 text-white px-4 py-2 rounded-lg border border-yellow-500 focus:outline-none">
                            <option value="" selected>Selecione...</option>
                            <option value="P">P - Presente</option>
                            <option value="F">F - Falta Injustificada</option>
                            <option value="FJ">FJ - Falta Justificada</option>
                            <option value="FE">FE - F√©rias</option>
                            <option value="FO">FO - Folga</option>
                            <option value="DSR">DSR - Descanso Semanal Remunerado</option>
                        </select>
                        <button onclick="abrirModalHoraExtra('Ana Paula Oliveira', 'ana.oliveira')" 
                                class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg transition-all flex items-center gap-1">
                            <i class="fas fa-clock"></i>
                            <span class="text-xs">HE</span>
                        </button>
                        <button onclick="abrirModalSinergia('Ana Paula Oliveira', 'ana.oliveira', 'Flow')" 
                                class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg transition-all flex items-center gap-1">
                            <i class="fas fa-exchange-alt"></i>
                            <span class="text-xs">SIN</span>
                        </button>
                        <span class="text-yellow-400">
                            <i class="fas fa-exclamation-triangle text-xl"></i>
                        </span>
                    </div>
                </div>

            </div>
        </div>

        <!-- Estat√≠sticas -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gray-800 rounded-lg p-4 text-center">
                <p id="stat-marcacao-total" class="text-3xl font-bold text-white">0</p>
                <p class="text-gray-400 text-sm">Total</p>
            </div>
            <div class="bg-green-900/30 border border-green-600 rounded-lg p-4 text-center">
                <p id="stat-marcacao-marcados" class="text-3xl font-bold text-green-400">0</p>
                <p class="text-green-300 text-sm">‚úÖ Marcados</p>
            </div>
            <div class="bg-purple-900/30 border border-purple-600 rounded-lg p-4 text-center">
                <p class="text-3xl font-bold text-purple-400">0</p>
                <p class="text-purple-300 text-sm">ü§ñ Autom√°ticos</p>
            </div>
            <div class="bg-yellow-900/30 border border-yellow-600 rounded-lg p-4 text-center">
                <p id="stat-marcacao-pendentes" class="text-3xl font-bold text-yellow-400">0</p>
                <p class="text-yellow-300 text-sm">‚ö†Ô∏è Pendentes</p>
            </div>
        </div>

        <!-- Bot√µes de A√ß√£o -->
        <div class="flex gap-4">
            <button onclick="salvarMarcacoes()" 
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg transition-all shadow-lg">
                <i class="fas fa-save mr-2"></i>
                Salvar Todas as Marca√ß√µes
            </button>
            
            <button onclick="recarregarManual()" 
                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg transition-all"
                    title="Buscar dados atualizados da planilha">
                <i class="fas fa-sync-alt mr-2"></i>
                Recarregar
            </button>
            
            <button onclick="irPara('tela-calendario')" 
                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-6 rounded-lg transition-all">
                <i class="fas fa-times mr-2"></i>
                Cancelar
            </button>
        </div>
    </div>
</div>

<!-- Modal de Sinergia -->
<div id="modalSinergia" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50" style="display: none;">
    <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl border border-gray-700">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-white">
                <i class="fas fa-exchange-alt text-purple-500 mr-2"></i>
                Registrar Sinergia
            </h2>
            <button onclick="fecharModalSinergia()" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="space-y-4">
            <div class="bg-gray-700 rounded-lg p-4">
                <p class="text-gray-400 text-sm mb-1">Colaborador:</p>
                <p class="text-white font-bold" id="sinNome">-</p>
                <p class="text-gray-400 text-xs mt-1">
                    WFM: <span id="sinWfmUser" class="text-white">-</span>
                </p>
                <p class="text-gray-400 text-xs mt-1">
                    Setor Atual: <span id="sinSetorAtual" class="text-white">-</span>
                </p>
            </div>

            <div>
                <label class="text-gray-400 text-sm mb-2 block">
                    <i class="fas fa-warehouse mr-1"></i>
                    Warehouse
                </label>
                <input type="text" 
                       id="sinWarehouse" 
                       value="BRFSP1"
                       readonly
                       class="w-full bg-gray-600 text-gray-400 px-4 py-3 rounded-lg border border-gray-600 cursor-not-allowed">
            </div>

            <div>
                <label class="text-gray-400 text-sm mb-2 block">
                    <i class="fas fa-arrow-right mr-1"></i>
                    Setor de Destino
                </label>
                <select id="sinSetorDestino" 
                        class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border border-gray-600 focus:border-purple-500 focus:outline-none">
                    <option value="">Selecione o setor...</option>
                    <option value="Inbound">Inbound</option>
                    <option value="Outbound">Outbound</option>
                    <option value="Flow">Flow</option>
                    <option value="Qualidade">Qualidade</option>
                    <option value="Administrativo">Administrativo</option>
                </select>
            </div>

            <div class="bg-blue-900/20 border border-blue-600 rounded-lg p-3">
                <p class="text-blue-400 text-sm mb-1">
                    <i class="fas fa-clock mr-1"></i>
                    Hor√°rio de Registro:
                </p>
                <p class="text-xl font-bold text-white" id="sinHorario">-</p>
                <p class="text-xs text-gray-400 mt-1">Autom√°tico</p>
            </div>
        </div>

        <div class="flex gap-3 mt-6">
            <button onclick="salvarSinergia()" 
                    class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg transition-all">
                <i class="fas fa-save mr-2"></i>
                Salvar em raw_sinergia
            </button>
            <button onclick="fecharModalSinergia()" 
                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all">
                <i class="fas fa-times mr-2"></i>
                Cancelar
            </button>
        </div>

        <div class="mt-4 bg-blue-900/20 border border-blue-600 rounded-lg p-3">
            <p class="text-blue-400 text-xs">
                <i class="fas fa-info-circle mr-1"></i>
                Salvos: <strong>WH, Nome, Setor Atual, Setor Destino, Hor√°rio</strong>
            </p>
        </div>
    </div>
</div>

<!-- Modal de Hora Extra -->
<div id="modalHoraExtra" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50" style="display: none;">
    <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl border border-gray-700">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-white">
                <i class="fas fa-clock text-orange-500 mr-2"></i>
                Registrar Hora Extra
            </h2>
            <button onclick="fecharModalHoraExtra()" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="space-y-4">
            <div class="bg-gray-700 rounded-lg p-4">
                <p class="text-gray-400 text-sm mb-1">Colaborador:</p>
                <p class="text-white font-bold" id="heNome">-</p>
                <p class="text-gray-400 text-xs mt-1">WFM: <span id="heWfmUser" class="text-white">-</span></p>
            </div>

            <div>
                <label class="text-gray-400 text-sm mb-2 block">
                    <i class="fas fa-warehouse mr-1"></i>
                    Warehouse
                </label>
                <input type="text" 
                       id="heWarehouse" 
                       value="BRFSP1"
                       readonly
                       class="w-full bg-gray-600 text-gray-400 px-4 py-3 rounded-lg border border-gray-600 cursor-not-allowed">
            </div>

            <div>
                <label class="text-gray-400 text-sm mb-2 block">
                    <i class="fas fa-calendar mr-1"></i>
                    Data
                </label>
                <input type="date" 
                       id="heData" 
                       value="2026-02-16"
                       class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
            </div>

            <div class="flex items-center gap-3 bg-gray-700 rounded-lg p-3">
                <input type="checkbox" 
                       id="heDiaInteiro"
                       onchange="toggleDiaInteiro()"
                       class="w-5 h-5 text-orange-600 bg-gray-600 border-gray-500 rounded focus:ring-orange-500">
                <label for="heDiaInteiro" class="text-white cursor-pointer">
                    <i class="fas fa-sun text-yellow-400 mr-2"></i>
                    Dia Inteiro (8 horas)
                </label>
            </div>

            <div id="heHorariosContainer">
                <div>
                    <label class="text-gray-400 text-sm mb-2 block">
                        <i class="fas fa-clock mr-1"></i>
                        Hora de In√≠cio
                    </label>
                    <input type="time" 
                           id="heHoraInicio" 
                           class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
                </div>

                <div class="mt-4">
                    <label class="text-gray-400 text-sm mb-2 block">
                        <i class="fas fa-clock mr-1"></i>
                        Hora de Fim
                    </label>
                    <input type="time" 
                           id="heHoraFim" 
                           class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border border-gray-600 focus:border-orange-500 focus:outline-none">
                </div>
            </div>

            <div class="bg-orange-900/20 border border-orange-600 rounded-lg p-3">
                <p class="text-orange-400 text-sm mb-1">Total de Horas Extras:</p>
                <p class="text-2xl font-bold text-white" id="heTotalHoras">0h 00min</p>
            </div>
        </div>

        <div class="flex gap-3 mt-6">
            <button onclick="salvarHoraExtra()" 
                    class="flex-1 bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-lg transition-all">
                <i class="fas fa-save mr-2"></i>
                Salvar em raw_hr
            </button>
            <button onclick="fecharModalHoraExtra()" 
                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-all">
                <i class="fas fa-times mr-2"></i>
                Cancelar
            </button>
        </div>

        <div class="mt-4 bg-blue-900/20 border border-blue-600 rounded-lg p-3">
            <p class="text-blue-400 text-xs">
                <i class="fas fa-info-circle mr-1"></i>
                Salvos: <strong>WH, Nome, WFM User, Data e Hora</strong>
            </p>
        </div>
    </div>
</div>

<script>
    // Navega√ß√£o entre telas
    function irPara(telaId) {
        document.querySelectorAll('.tela').forEach(t => t.classList.remove('active'));
        document.getElementById(telaId).classList.add('active');
        window.scrollTo(0, 0);
    }

    let warehouseSelecionado = null;
    let supervisorSelecionado = null;

    function selecionarWarehouse(codigo) {
        warehouseSelecionado = codigo;
        const nomes = { 'PE': 'Pernambuco', 'GO': 'Goi√°s', 'SP': 'S√£o Paulo' };
        document.getElementById('warehouse-nome').textContent = nomes[codigo];
        irPara('tela-meses');
    }

    function selecionarSupervisor(nome) {
        supervisorSelecionado = nome;
        irPara('tela-calendario');
    }

    // Modal Sinergia
    let sinColaboradorAtual = { nome: '', wfmUser: '', setorAtual: '' };

    function abrirModalSinergia(nome, wfmUser, setorAtual) {
        sinColaboradorAtual = { nome, wfmUser, setorAtual };
        document.getElementById('sinNome').textContent = nome;
        document.getElementById('sinWfmUser').textContent = wfmUser;
        document.getElementById('sinSetorAtual').textContent = setorAtual;
        
        const agora = new Date();
        const horarioFormatado = agora.toLocaleString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        document.getElementById('sinHorario').textContent = horarioFormatado;
        
        document.getElementById('modalSinergia').style.display = 'flex';
    }

    function fecharModalSinergia() {
        document.getElementById('modalSinergia').style.display = 'none';
        document.getElementById('sinSetorDestino').value = '';
    }

    function salvarSinergia() {
        const setorDestino = document.getElementById('sinSetorDestino').value;
        const horario = document.getElementById('sinHorario').textContent;
        
        if (!setorDestino) {
            alert('‚ö†Ô∏è Por favor, selecione o setor de destino.');
            return;
        }
        
        const dadosSinergia = {
            wh: document.getElementById('sinWarehouse').value,
            nome: sinColaboradorAtual.nome,
            wfmUser: sinColaboradorAtual.wfmUser,
            setorAtual: sinColaboradorAtual.setorAtual,
            setorDestino: setorDestino,
            horario: horario,
            planilha: 'raw_sinergia',
            spreadsheetId: '1pm0dtDn6x9k4Ct5u98pyD7FoAzl52GEzRazuFdPgU-w'
        };
        
        console.log('üìä Dados para raw_sinergia:', dadosSinergia);
        
        alert(`‚úÖ Sinergia registrada!

WH: ${dadosSinergia.wh}
Colaborador: ${dadosSinergia.nome}
Setor Atual: ${dadosSinergia.setorAtual}
Setor Destino: ${dadosSinergia.setorDestino}
Hor√°rio: ${dadosSinergia.horario}

Salvo em raw_sinergia.`);
        
        fecharModalSinergia();
    }

    // Modal Hora Extra
    let heColaboradorAtual = { nome: '', wfmUser: '' };

    function abrirModalHoraExtra(nome, wfmUser) {
        heColaboradorAtual = { nome, wfmUser };
        document.getElementById('heNome').textContent = nome;
        document.getElementById('heWfmUser').textContent = wfmUser;
        document.getElementById('modalHoraExtra').style.display = 'flex';
        
        document.getElementById('heHoraInicio').addEventListener('change', calcularTotalHoras);
        document.getElementById('heHoraFim').addEventListener('change', calcularTotalHoras);
    }

    function fecharModalHoraExtra() {
        document.getElementById('modalHoraExtra').style.display = 'none';
        document.getElementById('heHoraInicio').value = '';
        document.getElementById('heHoraFim').value = '';
        document.getElementById('heDiaInteiro').checked = false;
        document.getElementById('heHorariosContainer').style.display = 'block';
        document.getElementById('heTotalHoras').textContent = '0h 00min';
    }

    function toggleDiaInteiro() {
        const diaInteiro = document.getElementById('heDiaInteiro').checked;
        const horariosContainer = document.getElementById('heHorariosContainer');
        
        if (diaInteiro) {
            horariosContainer.style.display = 'none';
            document.getElementById('heTotalHoras').textContent = '8h 00min';
        } else {
            horariosContainer.style.display = 'block';
            document.getElementById('heTotalHoras').textContent = '0h 00min';
        }
    }

    function calcularTotalHoras() {
        const inicio = document.getElementById('heHoraInicio').value;
        const fim = document.getElementById('heHoraFim').value;
        
        if (inicio && fim) {
            const [hI, mI] = inicio.split(':').map(Number);
            const [hF, mF] = fim.split(':').map(Number);
            
            let totalMinutos = (hF * 60 + mF) - (hI * 60 + mI);
            
            if (totalMinutos < 0) {
                totalMinutos += 24 * 60;
            }
            
            const horas = Math.floor(totalMinutos / 60);
            const minutos = totalMinutos % 60;
            
            document.getElementById('heTotalHoras').textContent = `${horas}h ${minutos.toString().padStart(2, '0')}min`;
        }
    }

    function salvarHoraExtra() {
        const data = document.getElementById('heData').value;
        const diaInteiro = document.getElementById('heDiaInteiro').checked;
        const horaInicio = diaInteiro ? 'DIA INTEIRO' : document.getElementById('heHoraInicio').value;
        const horaFim = diaInteiro ? 'DIA INTEIRO' : document.getElementById('heHoraFim').value;
        const wh = document.getElementById('heWarehouse').value;
        
        if (!diaInteiro && (!horaInicio || !horaFim)) {
            alert('‚ö†Ô∏è Por favor, preencha os hor√°rios ou marque "Dia Inteiro".');
            return;
        }
        
        const dadosHoraExtra = {
            wh: wh,
            nome: heColaboradorAtual.nome,
            wfmUser: heColaboradorAtual.wfmUser,
            data: data,
            horaInicio: horaInicio,
            horaFim: horaFim,
            totalHoras: document.getElementById('heTotalHoras').textContent,
            diaInteiro: diaInteiro,
            planilha: 'raw_hr',
            spreadsheetId: '1pm0dtDn6x9k4Ct5u98pyD7FoAzl52GEzRazuFdPgU-w'
        };
        
        console.log('üìä Dados para raw_hr:', dadosHoraExtra);
        
        alert(`‚úÖ Hora Extra registrada!

WH: ${dadosHoraExtra.wh}
Colaborador: ${dadosHoraExtra.nome}
Data: ${dadosHoraExtra.data}
Hor√°rio: ${dadosHoraExtra.horaInicio} - ${dadosHoraExtra.horaFim}
Total: ${dadosHoraExtra.totalHoras}

Salvo em raw_hr.`);
        
        fecharModalHoraExtra();
    }

    // Auto-propaga√ß√£o de desligamentos (DV, DP, DF)
    function handleDesligamento(selectElement, colaboradorNome, wfmUser, diaAtual) {
        const sigla = selectElement.value;
        const siglasDesligamento = ['DV', 'DP', 'DF'];
        
        if (siglasDesligamento.includes(sigla)) {
            const confirmacao = confirm(
                `‚ö†Ô∏è DESLIGAMENTO DETECTADO\n\n` +
                `Colaborador: ${colaboradorNome}\n` +
                `Tipo: ${sigla}\n` +
                `Dia: ${diaAtual}/02/2026\n\n` +
                `Deseja propagar automaticamente esta marca√ß√£o para os dias seguintes do m√™s?\n\n` +
                `Isso marcar√° todos os dias de ${diaAtual + 1} at√© 28 com "${sigla}".`
            );
            
            if (confirmacao) {
                console.log(`üîÑ Auto-propagando ${sigla} para ${colaboradorNome} (${wfmUser})`);
                console.log(`üìÖ Dias afetados: ${diaAtual + 1} at√© 28 de Fevereiro 2026`);
                
                // Aqui seria a integra√ß√£o real com a planilha
                const diasAfetados = 28 - diaAtual;
                
                alert(
                    `‚úÖ Propaga√ß√£o Conclu√≠da!\n\n` +
                    `Colaborador: ${colaboradorNome}\n` +
                    `Marca√ß√£o: ${sigla}\n` +
                    `Dias propagados: ${diasAfetados} dias (${diaAtual + 1}/02 at√© 28/02)\n\n` +
                    `Todos os registros foram salvos na planilha ABS.`
                );
                
                // Log para integra√ß√£o backend
                console.log({
                    action: 'propagate_termination',
                    colaborador: colaboradorNome,
                    wfmUser: wfmUser,
                    sigla: sigla,
                    diaInicio: diaAtual,
                    diaFim: 28,
                    mes: 'Fevereiro',
                    ano: 2026,
                    diasAfetados: diasAfetados,
                    spreadsheetId: '1pm0dtDn6x9k4Ct5u98pyD7FoAzl52GEzRazuFdPgU-w',
                    planilha: 'ABS'
                });
            }
        }
    }

    // Adicionar listeners aos selects de marca√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
        // Adicionar listener a todos os selects de presen√ßa
        document.querySelectorAll('select[class*="bg-gray-600"]').forEach((select, index) => {
            select.addEventListener('change', function() {
                // Extrair informa√ß√µes do colaborador do DOM
                const card = this.closest('.bg-gray-700');
                const nomeElement = card?.querySelector('h3');
                const wfmElement = card?.querySelector('.text-gray-400');
                
                if (nomeElement && wfmElement) {
                    const nome = nomeElement.textContent.trim();
                    const wfmMatch = wfmElement.textContent.match(/WFM:\s*([^\s|]+)/);
                    const wfmUser = wfmMatch ? wfmMatch[1] : 'unknown';
                    const diaAtual = 16; // Dia atual (seria din√¢mico na implementa√ß√£o real)
                    
                    handleDesligamento(this, nome, wfmUser, diaAtual);
                }
            });
        });
    });

    // Fechar modais ao clicar fora
    document.getElementById('modalSinergia')?.addEventListener('click', function(e) {
        if (e.target === this) fecharModalSinergia();
    });

    document.getElementById('modalHoraExtra')?.addEventListener('click', function(e) {
        if (e.target === this) fecharModalHoraExtra();
    });

    // ==========================================
    // CONFIGURA√á√ÉO GLOBAL
    // ==========================================
    const WAREHOUSE = 'SP';
    const API_BASE = '';

    const SIGLAS_DESLIGAMENTO = ['DV', 'DP', 'DF'];
    const SIGLAS_COM_PERIODO = ['AM', 'AF', 'AL'];

    const OPCOES_PRESENCA = {
        'P': {nome: 'P - Presente'},
        'F': {nome: 'F - Falta'},
        'FJ': {nome: 'FJ - Falta Justificada'},
        'FE': {nome: 'FE - F√©rias'},
        'FO': {nome: 'FO - Folga'},
        'DSR': {nome: 'DSR - Descanso Semanal'},
        'AM': {nome: 'AM - Atestado M√©dico'},
        'AF': {nome: 'AF - Afastamento'},
        'AL': {nome: 'AL - Atraso Longo'},
        'BH': {nome: 'BH - Banco de Horas'},
        'TR': {nome: 'TR - Treinamento'},
        'SU': {nome: 'SU - Suspens√£o'},
        'PR': {nome: 'PR - Pr√©-Contrata√ß√£o'},
        'S1': {nome: 'S1 - Sa√≠da 1h'},
        'S2': {nome: 'S2 - Sa√≠da 2h'},
        'DV': {nome: 'DV - Desligamento Volunt√°rio'},
        'DP': {nome: 'DP - Desligamento Pedido'},
        'DF': {nome: 'DF - Desligamento For√ßa'},
        'NC': {nome: 'NC - N√£o Compareceu'}
    };

    let periodoAtual = null;

    function normalizeLider(valor) {
        if (!valor) return 'N√ÉO ATRIBU√çDO';
        return valor.trim().toUpperCase().normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '');
    }

    function getUserEmail() {
        const match = document.cookie.match(/user_email=([^;]+)/);
        return match ? decodeURIComponent(match[1]) : null;
    }

    // ==========================================
    // ESTADO OTIMIZADO COM ESTRUTURAS O(1)
    // ==========================================
    let estado = {
        warehouse: WAREHOUSE,
        mes: null,
        ano: null,
        supervisor: null,
        dia: null,

        colaboradores: [],
        todosColaboradores: [],
        todosSupervisores: [],

        // üî• OTIMIZA√á√ÉO 2: Maps para lookup O(1)
        mapTodosColaboradores: new Map(),
        mapColaboradores: new Map(),

        // üî• OTIMIZA√á√ÉO 2: √çndices computados
        indices: {
            desligadosNoMes: new Set(),      // wfmUser com desligamento
            porSupervisor: new Map(),        // supervisor -> [wfmUser]
            estatisticas: {
                total: 0,
                marcados: 0,
                pendentes: 0
            }
        },

        marcacoesModificadas: {},
        filtroStatus: 'todos'
    };

    let presencasAutomaticasCache = {};

    // ==========================================
    // OTIMIZA√á√ÉO 3: PROCESSAMENTO INICIAL (UMA PASSADA O(n))
    // ==========================================
    function processarDadosInicial(colaboradores) {
        console.log('[Performance] Processando dados inicial...');
        
        // Limpar estruturas
        estado.mapTodosColaboradores.clear();
        estado.indices.desligadosNoMes.clear();
        estado.indices.porSupervisor.clear();
        
        const supervisoresSet = new Set();
        
        // üî• UMA √öNICA ITERA√á√ÉO para popular tudo
        colaboradores.forEach(c => {
            // Normalizar l√≠der
            c.liderNormalizado = normalizeLider(c.lider);
            
            // Pr√©-calcular desligamento
            c.temDesligamento = false;
            if (c.marcacoes) {
                for (const dia in c.marcacoes) {
                    if (SIGLAS_DESLIGAMENTO.includes(c.marcacoes[dia].sigla)) {
                        c.temDesligamento = true;
                        estado.indices.desligadosNoMes.add(c.wfmUser);
                        break;
                    }
                }
            }
            
            // Popular mapa principal
            estado.mapTodosColaboradores.set(c.wfmUser, c);
            
            // Indexar por supervisor
            if (c.liderNormalizado && c.liderNormalizado !== 'N√ÉO ATRIBU√çDO') {
                supervisoresSet.add(c.liderNormalizado);
                
                if (!estado.indices.porSupervisor.has(c.liderNormalizado)) {
                    estado.indices.porSupervisor.set(c.liderNormalizado, []);
                }
                estado.indices.porSupervisor.get(c.liderNormalizado).push(c.wfmUser);
            }
        });
        
        estado.todosColaboradores = colaboradores;
        estado.todosSupervisores = Array.from(supervisoresSet).sort();
        
        console.log('[Performance] Processamento conclu√≠do:', {
            total: colaboradores.length,
            supervisores: estado.todosSupervisores.length,
            desligados: estado.indices.desligadosNoMes.size
        });
    }

    // CARREGAR M√äS (COM PR√â-C√ÅLCULO)
    async function selecionarMes(mes, ano) {
        estado.mes = mes;
        estado.ano = ano;

        mostrarLoading('Carregando supervisores...');

        const response = await fetch(`${API_BASE}/api/abs/colaboradores/${estado.warehouse}/${mes}/${ano}`, {
            headers: { 'x-user-email': getUserEmail() }
        });

        const data = await response.json();
        
        // üî• USAR PROCESSAMENTO OTIMIZADO
        processarDadosInicial(data.colaboradores || []);

        esconderLoading();
        carregarSupervisores();
        mostrarTela('supervisores');
    }

    // ==========================================
    // O(1) DESLIGAMENTO
    // ==========================================
    function temDesligamentoNoMes(colab) {
        return colab.temDesligamento === true;
    }

    // ==========================================
    // CARREGAR MARCA√á√ïES OTIMIZADO
    // ==========================================
    // ==========================================
    // OTIMIZA√á√ÉO 2: Filtro com cache O(k)
    // ==========================================
    function atualizarFiltroSupervisor() {
        // Usar √≠ndice pr√©-computado O(1)
        const wfmUsers = estado.indices.porSupervisor.get(estado.supervisor) || [];
        estado.colaboradores = wfmUsers
            .map(wfm => estado.mapTodosColaboradores.get(wfm))
            .filter(Boolean);
        
        // Atualizar mapa de colaboradores filtrados
        estado.mapColaboradores.clear();
        estado.colaboradores.forEach(c => {
            estado.mapColaboradores.set(c.wfmUser, c);
        });
    }

    function carregarMarcacoes() {

        const list = document.getElementById('colaboradores-list');
        const infoDia = document.getElementById('info-dia');

        if (list) list.innerHTML = '';
        if (infoDia) infoDia.textContent = `Dia ${estado.dia} - ${estado.mes} ${estado.ano}`;

        // üî• OTIMIZA√á√ÉO 2: Usar filtro com cache
        atualizarFiltroSupervisor();

        // üî• OTIMIZA√á√ÉO 6: Render inicial otimizado
        renderizarListaInicial();
    }

    /**
     * Buscar colaboradores de um warehouse para o m√™s selecionado
     */
    async function carregarColaboradores(warehouse, mes, ano, dia) {
        try {
            console.log(`[ABS] Carregando colaboradores: ${warehouse} - ${mes}/${ano}`);
            
            // üî• VERIFICAR CACHE ANTES DE FAZER FETCH
            const precisaCarregar = 
                estado.todosColaboradores.length === 0 || 
                estado.warehouse !== warehouse ||
                estado.mes !== mes ||
                estado.ano !== ano;
            
            if (precisaCarregar) {
                console.log('[ABS] Cache vazio ou dados diferentes, carregando...');
                estado.warehouse = warehouse;
                estado.dia = dia;
                await selecionarMes(mes, ano);
            } else {
                console.log('[ABS] Usando dados em cache, pulando fetch');
                estado.dia = dia;
            }
            
            // Buscar presen√ßa autom√°tica para este dia (sempre necess√°rio para o dia espec√≠fico)
            await carregarPresencaAutomatica(warehouse, dia);
            
            // Carregar marca√ß√µes para o dia
            carregarMarcacoes();
            
            return estado.todosColaboradores;
            
        } catch (error) {
            console.error('[ABS] Erro ao carregar colaboradores:', error);
            return [];
        }
    }

    /**
     * Buscar presen√ßa autom√°tica do raw_scan
     */
    async function carregarPresencaAutomatica(warehouse, dia) {
        try {
            // Formatar data como DD/MM/YYYY
            const data = `${String(dia).padStart(2, '0')}/02/2026`;
            
            console.log(`[ABS] Carregando presen√ßa autom√°tica: ${warehouse} - ${data}`);
            
            const response = await fetch(`/api/abs/presenca-automatica/${warehouse}/${data}`);
            const result = await response.json();
            
            if (!result.success) {
                console.error('[ABS] Erro ao carregar presen√ßa autom√°tica:', result.error);
                return;
            }
            
            // Armazenar em cache
            presencasAutomaticasCache = {};
            result.presencas.forEach(p => {
                presencasAutomaticasCache[p.wfmUser] = p;
            });
            
            console.log(`[ABS] ${result.presencas.length} presen√ßas autom√°ticas carregadas`);
            
        } catch (error) {
            console.error('[ABS] Erro ao carregar presen√ßa autom√°tica:', error);
        }
    }

    // ==========================================
    // OTIMIZA√á√ÉO 6: RENDER INICIAL COM DOCUMENTFRAGMENT
    // ==========================================
    function renderizarListaInicial() {
        const list = document.getElementById('colaboradores-list');
        const busca = document.getElementById('busca-colaborador')?.value.toLowerCase() || '';

        if (!list) return;

        list.innerHTML = '';
        
        if (estado.colaboradores.length === 0) {
            list.innerHTML = `
                <div class="bg-yellow-900/30 border border-yellow-500/50 rounded-xl p-6 text-center">
                    <i class="fas fa-exclamation-triangle text-yellow-400 text-3xl mb-3"></i>
                    <p class="text-gray-300">Nenhum colaborador encontrado para este warehouse/m√™s.</p>
                    <p class="text-gray-400 text-sm mt-2">Verifique se h√° dados na planilha ABS.</p>
                </div>
            `;
            return;
        }

        // üî• OTIMIZA√á√ÉO 6: Construir em mem√≥ria com DocumentFragment
        const fragment = document.createDocumentFragment();

        estado.colaboradores.forEach(colab => {

            // üî• OTIMIZA√á√ÉO 1: Usar Set para verifica√ß√£o O(1)
            if (estado.indices.desligadosNoMes.has(colab.wfmUser)) return;

            if (busca &&
                !colab.nome.toLowerCase().includes(busca) &&
                !colab.wfmUser.toLowerCase().includes(busca)) return;

            let marcacaoAtual =
                estado.marcacoesModificadas[colab.wfmUser]
                ?? colab.marcacoes?.[estado.dia]?.sigla
                ?? '';

            const temPresencaAutomatica = presencasAutomaticasCache[colab.wfmUser];
            const jaFoiMarcado = !!marcacaoAtual;

            const borderColor = jaFoiMarcado ? 'border-green-500' : 'border-yellow-500';
            const iconBg = jaFoiMarcado ? 'bg-green-600' : 'bg-yellow-600';
            const icon = jaFoiMarcado ? 'fa-check' : 'fa-clock';

            let badgeHtml = '';
            if (temPresencaAutomatica) {
                badgeHtml = `<span class="bg-green-600 text-white text-xs px-2 py-1 rounded-full">ü§ñ AUTO</span>`;
            } else if (!jaFoiMarcado) {
                badgeHtml = `<span class="bg-yellow-600 text-white text-xs px-2 py-1 rounded-full">‚ö†Ô∏è PENDENTE</span>`;
            } else if (estado.marcacoesModificadas[colab.wfmUser]) {
                badgeHtml = `<span class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">‚úèÔ∏è EDITADO</span>`;
            }

            const siglaAtual = marcacaoAtual || 'P';

            const item = document.createElement('div');
            item.className = `bg-gray-700 rounded-lg p-4 flex items-center justify-between hover:bg-gray-650 border-l-4 ${borderColor}`;
            item.dataset.wfm = colab.wfmUser;

            let selectOptions = '';
            for (const [sigla, info] of Object.entries(OPCOES_PRESENCA)) {
                selectOptions += `<option value="${sigla}" ${siglaAtual === sigla ? 'selected' : ''}>${info.nome}</option>`;
            }

            item.innerHTML = `
                <div class="flex items-center flex-1">
                    <div class="${iconBg} w-12 h-12 rounded-full flex items-center justify-center font-bold mr-4">
                        <i class="fas ${icon} text-white"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <h3 class="font-bold">${colab.nome}</h3>
                            ${badgeHtml}
                        </div>
                        <p class="text-gray-400 text-sm">
                            WFM: ${colab.wfmUser} | Supervisor: ${colab.supervisor || colab.lider || 'N/A'}
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <select class="bg-gray-600 text-white px-3 py-2 rounded-lg border border-gray-500 focus:border-blue-500 focus:outline-none text-sm"
                        data-wfm="${colab.wfmUser}"
                        onchange="marcarPresenca(this)">
                        ${selectOptions}
                    </select>
                    <button onclick="abrirModalHoraExtra('${colab.nome}', '${colab.wfmUser}')" 
                            class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg transition-all">
                        <i class="fas fa-clock mr-1"></i> HE
                    </button>
                    <button onclick="abrirModalSinergia('${colab.nome}', '${colab.wfmUser}', 'Expedi√ß√£o')" 
                            class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg transition-all">
                        <i class="fas fa-exchange-alt mr-1"></i> SIN
                    </button>
                </div>
            `;

            fragment.appendChild(item);
        });

        // üî• OTIMIZA√á√ÉO 6: Inser√ß√£o em lote (1 reflow)
        list.appendChild(fragment);
        
        // üî• OTIMIZA√á√ÉO 5: Estat√≠sticas desacopladas
        recalcularEstatisticas();
    }

    // Manter renderizarColaboradores como alias para compatibilidade
    function renderizarColaboradores() {
        renderizarListaInicial();
    }

    // ==========================================
    // ATUALIZA√á√ÉO INDIVIDUAL
    // ==========================================
    // ==========================================
    // OTIMIZA√á√ÉO 4: ATUALIZA√á√ÉO INDIVIDUAL DE DOM O(1)
    // ==========================================
    function atualizarColaboradorDOM(wfmUser, sigla) {
        const item = document.querySelector(`[data-wfm="${wfmUser}"]`);
        if (!item) return;
        
        // Atualizar apenas o select
        const select = item.querySelector('.marcacao-select');
        if (select && select.value !== sigla) {
            select.value = sigla;
        }
        
        // Atualizar apenas o badge
        const badge = item.querySelector('.badge') || item.querySelector('span[class*="bg-"]');
        if (badge) {
            if (!sigla || sigla === '') {
                badge.textContent = '‚ö†Ô∏è PENDENTE';
                badge.className = 'bg-yellow-600 text-white text-xs px-2 py-1 rounded-full';
            } else {
                badge.textContent = '‚úèÔ∏è EDITADO';
                badge.className = 'bg-blue-600 text-white text-xs px-2 py-1 rounded-full';
            }
        }
    }

    function marcarPresenca(select) {

        const wfmUser = select.dataset.wfm;
        const sigla = select.value;

        estado.marcacoesModificadas[wfmUser] = sigla;

        // üî• OTIMIZA√á√ÉO 4: Atualizar APENAS 1 elemento (n√£o rebuild)
        atualizarColaboradorDOM(wfmUser, sigla);
        
        // üî• OTIMIZA√á√ÉO 5: Estat√≠sticas sem tocar DOM da lista
        recalcularEstatisticas();
    }

    // Manter compatibilidade
    function atualizarItemIndividual(wfmUser, sigla) {
        atualizarColaboradorDOM(wfmUser, sigla);
    }

    // ==========================================
    // OTIMIZA√á√ÉO 5: ESTAT√çSTICAS DESACOPLADAS (SEM TOCAR DOM DA LISTA)
    // ==========================================
    function recalcularEstatisticas() {
        let total = 0;
        let marcados = 0;

        estado.colaboradores.forEach(c => {
            // üî• OTIMIZA√á√ÉO 1: Usar Set O(1)
            if (estado.indices.desligadosNoMes.has(c.wfmUser)) return;

            total++;
            const sigla =
                estado.marcacoesModificadas[c.wfmUser]
                ?? c.marcacoes?.[estado.dia]?.sigla;

            if (sigla) marcados++;
        });

        // üî• Atualizar APENAS os 3 n√∫meros (zero rebuild de lista)
        const statTotal = document.getElementById('stat-marcacao-total');
        const statMarcados = document.getElementById('stat-marcacao-marcados');
        const statPendentes = document.getElementById('stat-marcacao-pendentes');
        
        if (statTotal) statTotal.textContent = total;
        if (statMarcados) statMarcados.textContent = marcados;
        if (statPendentes) statPendentes.textContent = total - marcados;
        
        // Cache para reuso
        estado.indices.estatisticas = { total, marcados, pendentes: total - marcados };
    }

    // Manter compatibilidade
    function atualizarEstatisticas() {
        recalcularEstatisticas();
    }

    // ==========================================
    // OTIMIZA√á√ÉO 7: RECARGA INCREMENTAL (MERGE SEM RECRIAR)
    // ==========================================
    async function recarregarMarcacoes() {

        mostrarLoading('Recarregando dados...');

        try {
            const response = await fetch(`${API_BASE}/api/abs/colaboradores/${estado.warehouse}/${estado.mes}/${estado.ano}`, {
                headers: { 'x-user-email': getUserEmail() }
            });

            const data = await response.json();
            
            if (!data.success) {
                throw new Error(data.error || 'Erro ao recarregar');
            }

            const novos = data.colaboradores || [];

            // üî• OTIMIZA√á√ÉO 7: Atualiza√ß√£o incremental (preservar refer√™ncias)
            novos.forEach(novoColab => {
                const existente = estado.mapTodosColaboradores.get(novoColab.wfmUser);
                if (existente) {
                    // Atualizar apenas marca√ß√µes (mant√©m objeto)
                    existente.marcacoes = novoColab.marcacoes;
                    
                    // Re-calcular flag de desligamento
                    existente.temDesligamento = false;
                    if (existente.marcacoes) {
                        for (const dia in existente.marcacoes) {
                            if (SIGLAS_DESLIGAMENTO.includes(existente.marcacoes[dia].sigla)) {
                                existente.temDesligamento = true;
                                estado.indices.desligadosNoMes.add(existente.wfmUser);
                                break;
                            }
                        }
                    }
                    if (!existente.temDesligamento) {
                        estado.indices.desligadosNoMes.delete(existente.wfmUser);
                    }
                } else {
                    // Novo colaborador
                    novoColab.liderNormalizado = normalizeLider(novoColab.lider);
                    estado.todosColaboradores.push(novoColab);
                    estado.mapTodosColaboradores.set(novoColab.wfmUser, novoColab);
                }
            });

            // Limpar modifica√ß√µes locais
            estado.marcacoesModificadas = {};

            // Re-filtrar sem recriar
            atualizarFiltroSupervisor();

            // Render otimizado
            renderizarListaInicial();

            esconderLoading();
            
        } catch (error) {
            esconderLoading();
            alert(`Erro ao recarregar: ${error.message}`);
            console.error(error);
        }
    }

    // ==========================================
    // SALVAMENTO SEM RECARGA AUTOM√ÅTICA
    // ==========================================
    async function salvarMarcacoes() {
        const modificacoes = Object.keys(estado.marcacoesModificadas);
        
        if (modificacoes.length === 0) {
            alert('‚ÑπÔ∏è Nenhuma marca√ß√£o foi modificada.');
            return;
        }

        const confirmacao = confirm(
            `üíæ SALVAR MARCA√á√ïES\n\n` +
            `${modificacoes.length} marca√ß√£o(√µes) ser√°(√£o) salva(s).\n\n` +
            `Deseja continuar?`
        );
        
        if (!confirmacao) return;

        mostrarLoading(`Salvando ${modificacoes.length} marca√ß√£o(√µes)...`);

        try {
            // Preparar payload para API
            const payload = {
                warehouse: estado.warehouse,
                mes: estado.mes,
                ano: estado.ano,
                dia: estado.dia,
                supervisor: estado.supervisor,
                marcacoes: modificacoes.map(wfmUser => {
                    const colab = estado.mapColaboradores.get(wfmUser);
                    return {
                        wfmUser: wfmUser,
                        nome: colab?.nome || 'N/A',
                        sigla: estado.marcacoesModificadas[wfmUser],
                        lider: colab?.lider || colab?.supervisor
                    };
                })
            };

            // Enviar para servidor
            const response = await fetch(`${API_BASE}/api/abs/salvar-marcacoes`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-user-email': getUserEmail()
                },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            esconderLoading();

            if (!result.success) {
                throw new Error(result.error || 'Erro ao salvar');
            }

            // üî• ATUALIZAR CACHE LOCAL (SEM RECARREGAR P√ÅGINA)
            modificacoes.forEach(wfmUser => {
                const colab = estado.mapColaboradores.get(wfmUser);
                if (colab) {
                    if (!colab.marcacoes) colab.marcacoes = {};
                    colab.marcacoes[estado.dia] = {
                        sigla: estado.marcacoesModificadas[wfmUser],
                        data: new Date().toISOString()
                    };
                }
            });

            // Limpar modifica√ß√µes e atualizar badges visuais
            estado.marcacoesModificadas = {};
            
            modificacoes.forEach(wfmUser => {
                const item = document.querySelector(`[data-wfm="${wfmUser}"]`);
                if (item) {
                    const badge = item.querySelector('span[class*="bg-blue-600"]');
                    if (badge) {
                        badge.textContent = '‚úÖ SALVO';
                        badge.className = 'bg-green-600 text-white text-xs px-2 py-1 rounded-full';
                    }
                }
            });

            alert(`‚úÖ ${result.marcacoesSalvas || modificacoes.length} marca√ß√£o(√µes) salva(s) com sucesso!`);

        } catch (error) {
            esconderLoading();
            alert(`‚ùå Erro: ${error.message}`);
            console.error('[ABS] Erro ao salvar:', error);
        }
    }

    // Fun√ß√£o para recarga manual opcional
    async function recarregarManual() {
        if (Object.keys(estado.marcacoesModificadas).length > 0) {
            const confirmacao = confirm(
                '‚ö†Ô∏è H√° marca√ß√µes n√£o salvas.\n\nRecarregar ir√° perd√™-las.\n\nContinuar?'
            );
            if (!confirmacao) return;
        }
        
        await recarregarMarcacoes();
        alert('‚úÖ Dados atualizados!');
    }

    // ==========================================
    // FUN√á√ïES AUXILIARES DE UI
    // ==========================================
    function mostrarLoading(mensagem = 'Carregando...') {
        console.log(`[Loading] ${mensagem}`);
        // Implementa√ß√£o visual pode ser adicionada aqui
    }
    
    function esconderLoading() {
        console.log('[Loading] Ocultado');
        // Implementa√ß√£o visual pode ser adicionada aqui
    }
    
    function mostrarTela(telaId) {
        // Adaptar para o sistema de telas existente
        const telaMap = {
            'supervisores': 'tela-supervisores',
            'calendario': 'tela-calendario',
            'marcacao': 'tela-marcacao'
        };
        
        const telaCompleta = telaMap[telaId] || telaId;
        if (window.irPara) {
            window.irPara(telaCompleta);
        }
    }

    function carregarSupervisores() {
        // Implementar l√≥gica de supervisores se necess√°rio
        console.log('[ABS] Supervisores carregados');
    }

    /**
     * Propagar desligamento para dias seguintes
     */
    async function propagarDesligamento(wfmUser, nome, sigla, diaInicio) {
        try {
            console.log(`[ABS] Propagando desligamento: ${nome} - ${sigla} - A partir do dia ${diaInicio}`);
            
            const response = await fetch('/api/abs/propagar-desligamento', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    diaInicio,
                    mes: 'Fevereiro',
                    ano: 2026,
                    colaborador: nome,
                    wfmUser,
                    sigla,
                    supervisor: supervisorSelecionado || 'Sistema',
                    warehouse: warehouseSelecionado
                })
            });
            
            const data = await response.json();
            
            if (!data.success) {
                alert('‚ùå Erro ao propagar desligamento: ' + data.error);
                return;
            }
            
            alert(`‚úÖ Propaga√ß√£o conclu√≠da!\n\n${nome} foi marcado como ${sigla} em ${data.diasPropagados.length} dias`);
            
            console.log('[ABS] Desligamento propagado com sucesso:', data);
            
        } catch (error) {
            console.error('[ABS] Erro ao propagar desligamento:', error);
            alert('‚ùå Erro ao propagar desligamento. Verifique o console.');
        }
    }



    /**
     * Hook OTIMIZADO: S√≥ carrega se necess√°rio (ELIMINA RECARGA AUTOM√ÅTICA)
     */
    const irParaOriginal = window.irPara;
    window.irPara = function(telaId) {
        irParaOriginal(telaId);
        
        if (telaId === 'tela-marcacao' && warehouseSelecionado) {
            const dia = 16;
            // üî• SEMPRE CHAMA carregarColaboradores, mas ELE decide se faz fetch ou usa cache
            carregarColaboradores(warehouseSelecionado, 'Fevereiro', 2026, dia);
        }
    };
</script>

</body>
</html>
